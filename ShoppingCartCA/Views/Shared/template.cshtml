@using ShoppingCartCA.Views.Shared;
@{
    Layout = "_ShopLayout";
    ViewData["Title"] = "Cart";
    Product cartitem = (Product)ViewData["cartdata"];
}

@Html.Raw(DisplayAid.DisplayProduct(cartitem,"Purchase","chart"))

<br />

<div class='prod-holder-table'>
    <div class='prod-holder-row'>
        <div class='prod-col-img'>
            <img class='prod-img' src='@cartitem.Img' />
        </div>
    </div>
    <div class='prod-holder-row'>
        <div class='prod-col-title'>
            @cartitem.Name;
        </div>
    </div>
    <div class='prod-holder-row'>
        <div class='prod-col-dec'>
            @cartitem.Desc
        </div>
    </div>
    <div class='prod-holder-row'>
        <div class='prod-col-btn'>
            <input class='prod-button' type='button' action='/' value='$@cartitem.Price - Add to Cart' />
        </div>
    </div>
</div>

<script type="text/javascript">
    function AddToCart(prodId) {
        if (prodId == null) {
            return;
        }

        let xhr = new XMLHttpRequest();

        xhr.open("POST", "../Cart/AddToCart");

        xhr.setRequestHeader("Content-Type", "application/json; charset=utf8;");

        xhr.onreadystatechange = function () {
            if (this.readyState === XMLHttpRequest.DONE) {
                if (this.status !== 200) {
                    return;
                }

                let data = JSON.parse(this.responseText);

                if (data.addSuccess != true) {
                    window.href = "../Home";
                    return;
                }

                cartele = document.getElementById("CartSize");
                if (cartele != null) {
                    cartele.innerHTML = "Cart : "+data.cartqty;
                    cartele.value = data.cartqty;
                }

                alert("Added to cart");

            }
        }
        let DataCartProduct = {
            "ProdId": prodId,
        };

        xhr.send(JSON.stringify(DataCartProduct));
    }

</script>